**因子，模型和策略**

在等阿根廷对决克罗地亚的时间里，瞎扯几句

对于量化的初学者而言，经常分不清因子，模型和策略的关系。例如我说我用了158个因子，拟合了一个模型，最后使用了某某策略跑回测得出了不错的曲线。这就足以让许多人摸不着头脑：所以真正work的到底是因子？还是模型？还是策略？各个部分都做了什么事情？在回答这些问题之前，我们得首先搞清楚因子，模型和策略的概念，以及它们是如何构成交易的。

**首先是因子**。因子的概念众说纷纭，但我们可以从它的名字入手: 因子(factor), 原因嘛，再加个定语就是“让目标值成为当前值的原因”，反映到具体形式就是一个个有助于解释目标值的变量。那怎么判断一个变量是否有助于解释目标值呢？一是要有理论依据，这得通过看书和看论文，有时还得发挥自己的脑洞才能推理出来。二是要做实证检验，实证怎么做呢？我们可以通过计算因子与目标值的[mutual information](https://www.kaggle.com/code/ryanholbrook/mutual-information)或者其它指标，来判断因子包含目标值的信息量；计算因子的IC也是一种重要的方式，但值得注意的是单因子IC跟拟合模型后使用预测值算出来的IC是不一样的；还有古老的分组排序法等其它方法，但总体而言前两种用得更普遍些。

**其次是模型**。如果把因子当成$X$，那么模型就是$y=F(X)$。F(X)的形式有很多种，最经典的莫过于CAPM模型，它只使用了市场因子$R_M$，并且假设目标值（资产的超额收益率）与市场因子之间是线性关系：

$$y=R_i=\beta_i{R_M} + \alpha_i + \epsilon$$

其中，$y=R_i$是指目标值是资产i的超额收益率，$\beta_i$是资产i对市场风险的敏感度，$\alpha_i$是资产i在$R_{M}=0$时的超额收益率，也就是我们追求的$\alpha$，在CAPM里$\alpha_i=0$，$\epsilon$是公司层面的冲击，是一个均值为0的噪声。

CAPM只用了市场因子的理由是: 在有效市场中，股价已经充分反映了所有信息，因此股价不存在被高估或者低估的情况，因而收益率只跟市场波动有关(这也是为什么$\alpha=0$的原因)。然而很不幸的是，一系列的实证都拒绝了CAPM模型。为了解释市场中的异象，Fama和French又在市场因子的基础上加入了SMB（市值因子）和HML（账面市值比），形成了FF三因子模型:

$$R_i = \beta_{1i} R_M + \beta_{2i} SMB + \beta_{3i} HML + \alpha_i + \epsilon$$

而后人又不断地发现新因子，并加入到模型中，多因子模型于是流行开来。

介绍到这里，我们的模型仍然停留在线性回归模型上，而线性回归模型成立的条件是因子与目标值的关系是线性的，即:

$$y = \beta X + \alpha + \epsilon$$

其中，$X$里面的每个因子$x_i$都应该与其它因子线性无关，而且因子间不应该存在没被考虑到的相互作用关系。

显然这些假设太过于理想化，真实的情况是，我们既不能保证因子与目标值是线性关系，也不能保证因子之间相互独立，更不能保证它们的相互作用关系。于是拟合非线性关系的机器学习模型就开始取代线性回归模型，成为了研究的热点。对于表格数据（tabular data）树模型（XGBoost, lightgbm, catboost等等）的表现普遍较好，而各种神经网络结构也在不断探索中。但是，不管是线性回归模型，树模型，还是神经网络模型，它们都不过是$F(X)$的某种具体形式而已。

**最后是策略**。策略与目标值紧密相关。例如我设计一个策略:在股价准备上涨时买入股票，隔天卖出。假设我使用的是日频数据，那我的目标值就应该是

$R_i=\frac{Close_{i, -1}}{Close_{i, 0}} - 1$, 其中Close为收盘价，数字为滞后阶数

然后我怎么知道股价要上涨？那当然是使用前面的因子$X$和模型F(X)，预测我们的目标值:

$$\hat{R_i} = F(X)$$

最后我们根据$\hat{R_i}$的值和策略的具体内容，生成交易信号(什么**时候**以**多少钱**买或者卖多少**数量**的某种**资产**)，然后交给执行器来执行交易。而如果我们是用历史数据进行模拟交易，那这种行为就叫回测。我们可以根据回测的结果判断因子、模型和策略的好坏。

总而言之: 在量化交易中，我们使用策略和预测值来指导交易，而预测值又依赖于模型和因子，模型的结构和效果又很大程度由因子决定。至于怎么发现高质量的因子，怎么将原始数据正确地处理成因子，那就是另一个话题了。

恭喜梅老板！！！
